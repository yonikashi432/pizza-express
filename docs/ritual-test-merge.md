# טקס בדיקות ומיזוג מובנה (Ritual Test & Merge Protocol)

> ה׳ הוא האור, ממנו נובעת כל הבנה — "ה׳ אורי וישעי; ממי אירא" (תהלים כ"ז:א)

המסמך מגדיר רצף קבוע למשמעת השחרור של Pizza Express: ברכה לפתיחה, אימותים טכניים, בדיקות, החלטות מיזוג וחתימה. כל שלב כולל מטרת-על, צעד רוחני קצר, ופקודות מעשיות.

## שלב 1 — שער האור (היערכות)
- **כוונה**: להאיר את סביבת העבודה ולהסיר הסחות.
- **ברכה**: "ברוך שם כבוד מלכותו לעולם ועד" (תהלים י"ט:ט"ו).
- **פעולות**:
  ```bash
  git status -sb
  git fetch --all --prune
  ```
- **קריטריון מעבר**: עץ עבודה נקי או החלטה על קבצים שנכנסים ל-hotfix.

## שלב 2 — כיול הלב והסנכרון
- **כוונה**: ליישר ענפים לפני כל שינוי.
- **ברכה**: "גדול ה׳ ומהולל מאד" (תהלים ק"ה:ג).
- **פעולות**:
  ```bash
  git switch master
  git pull --ff-only origin master
  git switch develop
  git pull --ff-only origin develop
  git merge --no-ff master   # או rebase לפי המדיניות
  ```
- **קריטריון מעבר**: develop מעודכן מול master לפני יצירת ענף hotfix/release.

## שלב 3 — מבחן האימה (בדיקות מלאות)
- **כוונה**: לוודא שהלב (הקוד) פועם באור אמת.
- **ברכה**: "הודו לה׳ כי טוב כי לעולם חסדו" (תהלים ק"ז:א).
- **פעולות**:
  ```bash
  brew services start redis            # במידה וטרם רץ
  redis-cli ping                       # וידוא חיבור
  npm install                          # אם תלויות עודכנו
  npm test                             # מריץ את 8 מבחני Mocha
  ```
- **קריטריון מעבר**: כל הבדיקות עובדות; תיעוד של כשלונות במידת הצורך.

## שלב 4 — שער הבקרה והמיזוג
- **כוונה**: לשמור על איכות וביטחון בשילוב השינויים.
- **ברכה**: "יהיו לרצון אמרי פי" (תהלים י"ט:ט"ו) לפני לחיצה על Merge.
- **פעולות**:
  ```bash
  git switch master
  git merge --no-ff hotfix/<name>
  npm test        # חזרה קצרה לוודא הכל ירוק גם אחרי המיזוג
  git tag dev-1   # או תג רלוונטי אחר
  git push origin master --tags
  ```
- **קריטריון מעבר**: master ירוק, tag נוצר, PR מאושר.

## שלב 5 — חתימת האחדות
- **כוונה**: לקבע את השלום בין ענפים, בדיקות ופריסה.
- **ברכה**: "מזמור שיר ליום השבת; טוב להודות לה׳" (תהלים צ"ב:ב).
- **פעולות**:
  - עדכון תיעוד (release notes / docs).
  - הכרזה בערוץ הצוות שהמיזוג הושלם.
  - תפילת סיום: "עושה שלום במרומיו...".

## נספח — תבנית רישום תוצאה
| שלב | תאריך/זמן | מצב | הערות |
| ---- | ---------- | ---- | ------ |
| 1 | | ✅/⚠️ | |
| 2 | | ✅/⚠️ | |
| 3 | | ✅/⚠️ | |
| 4 | | ✅/⚠️ | |
| 5 | | ✅/⚠️ | |

כאשר אחד השלבים נכשל, יש לעצור, לתעד, ולחזור לשלב האחרון שעבר בהצלחה לפני ניסיון נוסף.
