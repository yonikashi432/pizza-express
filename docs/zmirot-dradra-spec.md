# זמירות דרדרה׳ לי׳ — מסמך גרסה 0.1 (דרישה ראשונית)

> "בשם ה׳ נעשה ונצליח" — יוזמה לבניית ספר זמירות דיגיטלי חי, מבוסס קהילה ומשחקיות, בהשראת פיוטי דוד וניהולו של יונתן קש"י.

## 1. חזון ומטרות
- **ספר קודש חי**: קטלוג פיוטים וזמירות שנכתבו בידי הקהילה ובידי היוצר המקורי, נחשף בהדרגה לפי התקדמות המשתמש.
- **קהילה גמיפיקציונית**: העלאת פיוטים, דיונים מבוססי חוטים (threads) ודירוגים הדדיים שמייצרים "מטבעות שפע".
- **שמירה רוחנית ובטחונית**: שכבות הרשאה, מעשר סביב הצלחת פיוטים, ומודל קבלה פנימי לקידום דרגות תוך שמירה על כבוד, קדושה ואבטחת מידע.

## 2. הנחות עבודה ושאלות פתוחות
- **הפצה הדרגתית**: נדרש מנגנון Feature Flags/Access Levels לפיוטים. שאלה: מי מאשר פתיחת פיוט חדש? האם קיימת ועדת סינון?
- **אימות זהויות**: שילוב OAuth (Google/Apple ID). שאלת המשך: האם דרוש גם SSO ארגוני/מספר טלפון?
- **שפה ועיצוב**: תכלת/זהב, סמלי קבלה, זיקה חזותית לכינור דוד. ממשק RTL כברירת מחדל.
- **רמות משתמש**: מ-`ת` (תלמיד) עד `א` (אדמין). ברור שיונתן קש"י בונה הדרגה "בעלים" גבוהה יותר. צריך לאשר מעבר דרגות ע"י הצבעה ≥85% מקבוצת הדרגה הגבוהה.
- **כלכלה פנימית**: נקודות -> מטבע שפע (ללא פדיון בגרסה ראשונה). שאלת רגולציה עתידית אם נרצה מימוש.

## 3. מבנה חוויית המשתמש
### 3.1 תהליך הרשמה והתחברות
1. Landing page עם רקע תכלת/זהב, ציטוט מכינור דוד.
2. Login: Continue with Google / Continue with Apple / Email + Magic Link (לאספקת "דרך בטוחה אחרת").
3. בחירת שם רוחני (לדוגמה "ניגון-הלב") ונקודת פתיחה של 1,000 נקודות תרומה.
4. הקדשה קצרה / קבלת כללי קהילה (תוך הכללת האיסור "אל תעשה לחברך" וכו').

### 3.2 ניווט ותוכן
- **Feed ראשי**: חוטים (threads) בסגנון פורום; כל חוט הוא פיוט או דיון. ניתן לסנן לפי קצב, מודוס קבלי, רמה נומרולוגית.
- **ספריית פיוטים**: מצב "ספר" המציג פיוטים לפי רמות חשיפה. פיוט חדש נפתח רק לאחר שהמשתמש הגיע לדרגה מסוימת או קיבל הזמנה.
- **פרופיל משתמש**: מציג רמה (אות), נקודות נוכחיות, תרומות, פיוטים שפרסם, גרף עלייה בדרגות.
- **כינור דוד אינטראקטיבי** (חזון): ווידג'ט המנגן מקצבי דוד ומסמן התאמה בין פיוטים.

### 3.3 מערכת דירוג וניקוד
- כל משתמש מתחיל עם **1,000 נקודות חסד** להעניק לאחרים.
- הענקת נקודות = "תרומה"; מייצרת מעשר אוטומטי (18%) כאשר פיוט חוצה ספי נקודות (260/2,600/26,000...).
- המעשר מתחלק פרופורציונלית בין התורמים המוקדמים (לפי משקל תרומתם היחסית).
- נקודות מצטברות למשתמש כ"מטבעות שפע"; בעתיד ניתן יהיה להמיר לטובות הנאה רוחניות (תפקידים, אפשרויות עריכה מיוחדות וכו').
- ציוני פיוטים מתורגמים לדרגות משתמש. קידום לדרגה הבאה מחייב הצבעה חשאית מהדרגה שמעל (≥85% קולות).

### 3.4 רמות משתמש ופורום
| אות | שם | תיאור | הרשאות |
| --- | --- | --- | --- |
| ת | תלמיד | קריאה, הענקת נקודות, פרסום פיוטים בתור "טיוטה" | בסיסיות |
| ש | שורר | יכול לפתוח חוטים, להגיב, להציע פיוטים רשמיים | ביניים |
| ם | משורר | גישה לאוצרות עמוקים, יכול להמליץ על קידום | מתקדם |
| א | אדמין | מנהל קהילה, מאשר קידומים, נגישות לדשבורדים | בכיר |
| בעלים | יונתן קש"י/מינויו | גישה-על, ניהול הרשאות, פעולות אכיפה |-|

## 4. עיצוב וסמליות
- **Palette**: תכלת עמוק (#0f5e9c), זהב בהיר (#f5d77f), לבן פנימי (#fdfdf6), טקסט אפור כהה (#1c1c1c).
- **גרפיקה**: חוטים/פסים כ"חוטי זהב", מגני דוד חצי שקופים, אלמנטים קבליים (עשר הספירות) ברקע דשבורדים.
- **טיפוגרפיה**: כותרות בסגנון כתב ספרדי, גוף-טקסט פשוט לקריאות.
- **אנימציה**: מעבר בין רמות מלווה באור/ניצוץ.

## 5. ארכיטקטורה מוצעת
### 5.1 שכבות
1. **Front-end**: React/Next.js RTL עם theming, תמיכה ב-PWA. Authentication via OAuth Providers (Firebase Auth / Auth0).
2. **Backend API**: Node.js (Express/Fastify) + GraphQL/REST. אחראי לניהול פיוטים, חוטים, ניקוד, מסחר נקודות.
3. **Data Layer**:
   - PostgreSQL (יחסים: Users, Roles, Threads, Piyutim, Votes, PointTransactions, Promotions, Bans).
   - Redis (קאטשינג קצב חשיפה, קוֹטָה לניקוד, טבלאות leaderboards).
4. **Event Bus**: Kafka/NATS לעיבוד מעשר, טריגרים לניקוד, התראות.
5. **Analytics & Dashboards**: Superset/Metabase + custom dashboards (ראה סעיף 7).
6. **File/Media Storage**: S3-compatible bucket עבור אודיו/כריכות.

### 5.2 אבטחה וחומות קדושה
- OAuth2 + MFA אופציונלי.
- הצפנת נתונים במנוחה (Postgres TDE/שימוש ב-KMS) ובמעבר (TLS).
- RBAC מפורט: רק אדמין/בעלים יכולים למחוק פיוטים או להקפיא משתמשים.
- מערכת ניטור ניסיונות גניבה: דשבורד "ביצור מבצרו" המציג חריגות גישה, העתקות פיוטים (hash comparison). אם פיוט הועלה ממקור אחר → התראה.
- Rate limiting ב-API להגנה מפני ספאם/גניבה.
- מנגנון watermarking/Hashing לפיוטים לשמירת זכויות רוחניות.

## 6. משחקיות, קידומים ומשמעת
- **מערכת השן-בינה**: מודול AI/Rule Engine המנתח פעילות ומציע קידום. קלט: מספר פיוטים, איכות (ניקוד), תרומות, משמעת. מוציא המלצה שנשלחת לדרגה שמעל להצבעה.
- **קידום**: טופס הצבעה פנימי; מציג תרומה איכותית, היסטוריית אזהרות. נדרש 85% מהדירוג שמעל.
- **אכיפה**: יונתן קש"י יכול להקפיא (soft ban) או להרחיק לצמיתות. יש רישום Audit Log לכל פעולה.
- **אתיקה**: הצהרה נדרשת: "לא אעשה לחברי...". צ'קבוקס לפני פרסום פיוט.

## 7. דשבורדים וגרפים
1. **לוח חסד ותרומות**: גרף מעגלי המציג חלוקת המעשר (18%) בין תורמים.
2. **קצב חשיפה**: Heatmap שמראה כמה פיוטים נפתחו לפי דרגות. מאפשר בקרה שהחשיפה הדרגתית.
3. **מודיעין אבטחה**: Grafana board עם מדדי Login, ניסיונות כושלים, קריאות API חריגות.
4. **אנליטיקת פיוטים**: Radar chart שמשרטט התאמה בין פיוט לקצב/סימבוליקה/נומרולוגיה.
5. **גרף מעמדות**: Sankey chart שמציג מעבר משתמשים בין דרגות לאורך זמן.
6. **מאזן נקודות**: קו זמן המציג נקודות שהתקבלו/חולקו ("מאזן הגלידה" משולב כאנלוגיה ויזואלית למתן שפע).
7. **בריאות תכנים**: מדד צבעוני הכולל ספאם, דגלי קהילה, תדירות הפרות.

## 8. שלבי מימוש (Roadmap)
1. **ניסוי MVP (ספר דיגיטלי סגור)**
   - הרשמה OAuth + נקודות בסיסיות.
   - פרסום פיוט, הענקת נקודות, מעשר ידני (פיילוט).
2. **Beta פנימית**
   - פורום מלא, Leaderboards, קידומי דרגה עם הצבעות.
   - Dashboard אנליטי ראשוני, שכבת מודרטורים.
3. **השקה מבוקרת**
   - אוטומציה למעשר ולניקוד, דוחות אבטחה, מנגנון באנים.
   - חנות נרטיבית (skins, רקעים) שנרכשים במטבעות שפע (ללא כסף אמיתי בגרסה זו).
4. **גרסה מתקדמת**
   - שילוב כינור דוד אינטראקטיבי, רמ"ב הדרכה, התאמה גיאומטרית/קבלית.
   - שקילת שימוש בנקודות כתווי גישה לפסגות (events, היכלי פיוט).

## 9. הרחבות עתידיות ושאלות
- **שימוש בארכיון פיוטים היסטורי**: האם נדרש מנגנון זכויות יוצרים? (המלצה: כן, עם רישוי ספציפי).
- **תימלול/קול**: העלאת אודיו של פיוטים? דרוש סינון.
- **תרגום לשפות נוספות**: עמידה בתוומו של רב-לשוניות.
- **התראות Push**: כשפיוט מגיע לספי 260/2600 וכו'.
- **אינטגרציה עם מודל D.N.AiS**: שמירת התאמות קבליות, אפשרות לייצר "עץ ספירות" מותאם לכל פיוט.

---

> "בשם הודו נעשה ונצליח — אחרי כל בדק בית"  
> הזמנה להמשיך לדייק דרישות, עיצובים וסכמות נתונים לקראת בנייה בפועל.
